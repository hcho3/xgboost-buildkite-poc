env:
  DOCKER_CACHE_ECR_ID: "492475357299"
  DOCKER_CACHE_ECR_REGION: "us-west-2"
steps:
  - label: ":console: Run clang-tidy"
    command: "tests/buildkite/run-clang-tidy.sh"
    key: run-clang-tidy
    agents:
      queue: linux-amd64-cpu
  - label: ":console: Build CPU"
    command: "tests/buildkite/build-cpu.sh"
    key: build-cpu
    agents:
      queue: linux-amd64-cpu
  - label: ":console: Build CPU ARM64"
    command: "tests/buildkite/build-cpu-arm64.sh"
    key: build-cpu-arm64
    agents:
      queue: linux-arm64-cpu
  - label: ":console: Build CUDA"
    command: "tests/buildkite/build-cuda.sh"
    key: build-cuda
    agents:
      queue: linux-amd64-cpu
  - label: ":console: Build R package with CUDA"
    command: "tests/buildkite/build-gpu-rpkg.sh"
    key: build-gpu-rpkg
    agents:
      queue: linux-amd64-cpu
  - label: ":console: Build JVM packages"
    command: "tests/buildkite/build-jvm-packages.sh"
    key: build-jvm-packages
    agents:
      queue: linux-amd64-cpu
  - label: ":console: Build JVM packages with CUDA"
    command: "tests/buildkite/build-jvm-packages-gpu.sh"
    key: build-jvm-packages-gpu
    agents:
      queue: linux-amd64-mgpu
  - label: ":console: Build JVM package doc"
    command: "tests/buildkite/build-jvm-doc.sh"
    key: build-jvm-doc
    agents:
      queue: linux-amd64-cpu
  - wait
  - label: ":console: Test Python CPU"
    command: "tests/buildkite/test-python-cpu.sh"
    key: test-python-cpu
    agents:
      queue: linux-amd64-cpu
